# ğŸ›¡ï¸ Securing `/etc/hosts` with ACLs

## ğŸ“Œ Problem Statement

During a recent **security audit** in Stratos DC, the Nautilus team discovered **misconfigured permissions** on the critical system file `/etc/hosts` on **App Server 3**.

The following corrections are required:

1. The fileâ€™s **user owner** and **group owner** must be `root`.
2. **Others** should have **read-only** access.
3. User **`siva`** must have **no permissions**.
4. User **`garrett`** must have **read-only** permission.

---

## â“ Question

**How can we configure ownership and ACLs on `/etc/hosts` to meet the security requirements?**

---

## ğŸ’¡ Answer

### ğŸ”¹ Step 1: Connect to App Server 3

```bash
ssh banner@stapp03
```

---

### ğŸ”¹ Step 2: Set Owner and Group to Root

```bash
sudo chown root:root /etc/hosts
```

Verify:

```bash
ls -l /etc/hosts
```

Expected:

```
-rw-r--r-- 1 root root ... /etc/hosts
```

---

### ğŸ”¹ Step 3: Set Base Permissions (Others â†’ Read-Only)

```bash
sudo chmod 644 /etc/hosts
```

* Owner â†’ `rw-`
* Group â†’ `r--`
* Others â†’ `r--`

---

### ğŸ”¹ Step 4: Remove All Permissions for `siva`

```bash
sudo setfacl -m u:siva:--- /etc/hosts
```

---

### ğŸ”¹ Step 5: Grant Read-Only Permission to `garrett`

```bash
sudo setfacl -m u:garrett:r-- /etc/hosts
```

---

### ğŸ”¹ Step 6: Verify ACLs

```bash
getfacl /etc/hosts
```

Expected output snippet:

```
# file: /etc/hosts
# owner: root
# group: root
user::rw-
user:siva:---
user:garrett:r--
group::r--
mask::r--
other::r--
```

---

## ğŸ“Š Before & After Permissions

| State       | Owner/Group     | Others    | siva              | garrett   |
| ----------- | --------------- | --------- | ----------------- | --------- |
| âŒ Before    | (misconfigured) | (unclear) | (may have access) | (no ACLs) |
| âœ… After Fix | root\:root      | read-only | no access         | read-only |

---

## ğŸ” Visual Diagram of Access

```
          File: /etc/hosts

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Owner ğŸ‘¤ â”‚  Group ğŸ‘¥  â”‚   Others ğŸŒ   â”‚   siva ğŸš«   â”‚ garrett ğŸ‘“   â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚   rw-    â”‚    r--    â”‚     r--     â”‚    ---     â”‚     r--     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ  Real-World Analogy

Think of `/etc/hosts` like a **locked office cabinet** ğŸ“‚:

* **Owner (root ğŸ‘¤)** = The manager â†’ has **full access** (read/write).
* **Group (root ğŸ‘¥)** = Trusted team â†’ can **look inside but not change**.
* **Others (ğŸŒ all employees)** = Allowed to **peek inside only**.
* **siva ğŸš«** = Blocked employee â†’ cannot access the cabinet at all.
* **garrett ğŸ‘“** = Temporary consultant â†’ can **view documents but not edit**.

---

## ğŸ¯ Outcome

* `/etc/hosts` is now **owned by root\:root**.
* **Others** have **read-only access**.
* **siva** is **explicitly denied access**.
* **garrett** has **read-only access**.

âœ… Security compliance restored!

---

## ğŸ“ Points to Remember

* `chown` â†’ changes owner & group.
* `chmod` â†’ sets base permissions (owner, group, others).
* `setfacl` â†’ fine-tunes permissions for specific users.
* Always verify changes with `ls -l` and `getfacl`.
* To remove ACLs if needed:

  ```bash
  sudo setfacl -x u:siva /etc/hosts
  sudo setfacl -x u:garrett /etc/hosts
  ```

---
